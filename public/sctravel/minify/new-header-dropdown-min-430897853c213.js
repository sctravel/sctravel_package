(function(b){var c='[data-control="menu"], .dropdown-toggle';function a(){b(c).parent("li").removeClass("open");}b(function(){b("html").bind("click",a);b("body").dropdown('[data-control="menu"], .dropdown-toggle');});b.fn.dropdown=function(d){return this.each(function(){b(this).delegate(d||c,"click",function(h){var f=b(this).parent("li"),g=f.hasClass("open");a();!g&&f.toggleClass("open");return false;});});};})(window.jQuery||window.ender);if(typeof xp==="undefined"){var xp={};}if(typeof xp.namespace==="undefined"){xp.namespace=function(){var c=arguments,a=null,b;for(i=0;i<c.length;i=i+1){b=c[i].split(".");a=window;for(j=0;j<b.length;j=j+1){a[b[j]]=a[b[j]]||{};a=a[b[j]];}}return a;};}xp.namespace("xp.nav");xp.nav.trackAnalytics=function(b,a,c){if("undefined"!=typeof(s_exp_trackClick)&&s_exp_trackClick){s_exp_trackClick(b,a,c);}return true;};xp.namespace("xp.nav.event");xp.nav.event.onDOMReady=function(b){if(window.addEventListener){window.addEventListener("load",b,false);}else{if(window.attachEvent){window.attachEvent("onload",b);}else{if(window.onload!=null){var a=window.onload;window.onload=function(c){a(c);window[b]();};}else{window.onload=b;}}}};fillTestOverrideParams=function(){var a=window.location.pathname+window.location.search+window.location.hash;if(a.indexOf("ue2e")!=-1){document.getElementById("header-itineraries").href+=a;}};langRedirectionUrl=function(d){var a="/pub/agent.dll?qscr=chlg&lang={langID}&ovrd=3&rurl=",h=window.location.pathname,f=d.href.split("?langid=")[1],k=window.location.search,c=window.location.hash,e=d.href;var g=(h.indexOf("agent.dll")>-1)||(h.indexOf("/daily/")>-1);var b=window["header_feedDomain"];a=a.replace("{langID}",f);if(g){e=a+encodeURIComponent(window.location);}if(b){e="http:"+window["header_feedDomain"]+a+encodeURIComponent("http:"+window["header_feedDomain"]+"/");}else{if(k===""){k="?";}if(k.indexOf("langid=")>-1){k=k.replace(/langid=\d+/,"langid="+f);}else{k=k+"&langid="+f;}e=h+k+c;}window.location.href=e;};appendRedirectionUrl=function(b,e){var e=e||this,d=e.location.pathname,a=(/uurl=([^&]+)/.exec(e.location.search)||[])[1],h,g,c,f=e["header_feedDomain"];if(b.href.indexOf("/user/signin")!=-1){h="/user/signin?ckoflag=0";}else{if(b.href.indexOf("/user/login")!=-1){h="/user/login?ckoflag=0";}else{h="/user/logout?";}}if(f){h="http:"+e["header_feedDomain"]+h+"&uurl=http:"+e["header_feedDomain"];}else{if(a&&a.indexOf("e3id")!==-1){h=h+"&uurl="+a;}else{if(d==="/Hotel-Search"){g=d+e.location.search+e.location.hash.replace("#",(e.location.search===""?"?":"&"));c="&uurl="+encodeURIComponent("e3id=redr&rurl="+g);h=h+c;}else{if(d!=="/"){g=d.concat(e.location.search,e.location.hash);c="&uurl="+encodeURIComponent("e3id=redr&rurl="+g);h=h+c;}}}}e.location.href=h.replace(/\'/g,"").replace(/\"/g,"");};addScratchpadBadge=function(c){function b(){var d;if(window.XMLHttpRequest){d=new XMLHttpRequest();}else{d=new ActiveXObject("Microsoft.XMLHTTP");}d.onreadystatechange=function(){if(d.readyState==4&&d.status==200){if(d.responseText){var f=JSON.parse(d.responseText);var g=document.getElementById("scratchpad-badge");if(f.count>0){if(f.count>30){f.count=30;}g.textContent=f.count;g.className=g.className.replace("visuallyhidden","");}else{g.textContent="0";}}}};var e=document.getElementById("scratchpad-badge");if(e.textContent.length==0){d.open("GET","/api/userhistory/count",true);d.send();}}function a(){if($("#scratchpad-badge").text().length==0){$.ajax({dataType:"json",url:"/api/userhistory/count",success:function(d){if(d.count>0){if(d.count>30){d.count=30;}$("#scratchpad-badge").removeClass("visuallyhidden").text(d.count);}else{$("#scratchpad-badge").text("0");}},cache:false,timeout:500});}}if(window.isScratchpadTrayEnabled&&(!!isScratchpadTrayEnabled||c)){if(typeof $=="function"&&typeof $.ajax=="function"){a();}else{b();}}};function headerFeedback(m){var c=screen.width,f=screen.height,o=(document.getElementById("home-page")!==null),g=OpinionLab_FB.O_HT(),a,d="ModalPopUp",h,b="/p/info-other/feedback.htm";var n=((f-192)/2),k=((c-535)/2);if(o){g=g.replace("Homepage.html","Homepage-new.html");}if(window["header_feedBackUrl"]!==undefined){b=header_feedBackUrl;}a=b+"?referer="+g+"&customvar="+OpinionLab_FB.O_CV()+"&prev="+OpinionLab_FB.O_PRV();h=["toolbar=no","scrollbars=no","location=no","statusbar=no","menubar=no","resizable=no","width=635px","height=280px","screenX="+k,"screenY="+n,"left="+k,"top="+n].join(",");var l=window.open(a,d,h);l.focus();}(function(a){a("body").delegate("*[data-onclick]","click",function(c){if(typeof uitk==="undefined"){var b=a(this).attr("href");if(b){b=b.replace(window.location.href.split("#")[0],"");}if(b=="#"||b==""){c.preventDefault();}return new Function(a(this).data("onclick")).apply(this);}});})(window.jQuery||window.open||window.ender);function closeBanner(){document.getElementById("redirectBanner").style.display="none";xp.nav.trackAnalytics(this,"a","Header:IPSniff:Close");s_exp_trackClick(this,"o","Header:IPSniff:Close");}var OpinionLab_FB=(function(){var custom_var,_sp="%3A\\/\\/",_rp="%3A//",_poE=0,_poX=0,_sH=screen.height,_d=document,_w=window,_ht=escape(_w.location.href),_hr=_d.referrer,_tm=(new Date()).getTime(),_kp=0,_sW=screen.width;function _fC(_u){_aT=_sp+",\\/,\\.,-,_,"+_rp+",%2F,%2E,%2D,%5F";_aA=_aT.split(",");for(i=0;i<5;i++){eval("_u=_u.replace(/"+_aA[i]+"/g,_aA[i+5])");}return _u;}function _fPe(){if(Math.random()>=1-_poE){O_LC();_poX=0;}}function _fPx(){if(Math.random()>=1-_poX){O_LC();}}function _populateCustomVar(){var t="";var g="";if((typeof(dctk)!=="undefined")&&(typeof(dctk.omtr)!=="undefined")){t=(typeof(dctk.omtr.prop11)!=="undefined")?dctk.omtr.prop11:"";g=(typeof(dctk.omtr.prop12)!=="undefined")?dctk.omtr.prop12:"";}else{if(typeof(s_exp)!=="undefined"){t=(typeof(s_exp.prop11)!=="undefined")?s_exp.prop11:"";g=(typeof(s_exp.prop12)!=="undefined")?s_exp.prop12:"";}else{t=(typeof(s_prop11)!=="undefined")?s_prop11:"";g=(typeof(s_prop12)!=="undefined")?s_prop12:"";}}custom_var=g+"|"+t;}function _replacePageName(){var page_name=null;page_name=((typeof(dctk)!=="undefined")&&(typeof(dctk.omtr)!=="undefined"))?escape(dctk.omtr.pageName)+".html":((typeof(s_exp)!=="undefined")&&(typeof(s_exp.pageName)!=="undefined"))?escape(s_exp.pageName)+".html":(typeof(s_pageName)!=="undefined")?escape(s_pageName)+".html":null;if(page_name){var l_page_name=page_name.toLowerCase();if(l_page_name.search("infosite")>=0){page_name=null;}}if(page_name){_domain=_ht.replace("https%3A//","").replace("http%3A//","");_ht=_ht.substr(0,_ht.indexOf("%3A//"))+"%3A//"+_domain.substr(0,_domain.indexOf("/"))+"/"+page_name;}if(typeof(bIsCAFR)!="undefined"){if(bIsCAFR==true){_lG="fr-CA.";_rp="%3A//"+_lG;}}if(typeof(bIsMSMY)!="undefined"){if(bIsMSMY==true){_lG="ms-my.";_rp="%3A//"+_lG;}}if(typeof(OlAltLang)!="undefined"){if(OlAltLang!=null){_lG=OlAltLang;_rp="%3A//"+_lG;}}}return{O_HT:function(){_replacePageName();return _ht;},O_CV:function(){_populateCustomVar();return custom_var;},O_PRV:function(){if(_hr==null||_hr.length<1){return"null";}return escape(_hr);},O_LC:function(target,referer,customvar,prev){_replacePageName();_populateCustomVar();if(target==null||target.length<1){target="comments";}if(referer==null||referer.length<1){referer=_ht;}if(customvar==null||customvar.length<1){customvar=custom_var;}if(prev==null||prev.length<1){prev=_fC(escape(_hr));}else{if(prev=="null"){prev="";}else{prev=_fC(escape(prev));}}_w.open("https://secure.opinionlab.com/ccc01/comment_card.asp?time1="+_tm+"&time2="+(new Date()).getTime()+"&prev="+prev+"&referer="+_fC(referer)+"&height="+_sH+"&width="+_sW+"&custom_var="+customvar,target,"width=535,height=192,screenX="+((_sW-535)/2)+",screenY="+((_sH-192)/2)+",top="+((_sH-192)/2)+",left="+((_sW-535)/2)+",resizable=yes,copyhistory=yes,scrollbars=no");},O_GoT:function(_p){_d.write("<a href='javascript:O_LC()'>"+_p+"</a>");}};})();window.scratchpadInterventionAllowed=(function(){if(window.localStorage){var b=(localStorage.getItem("scratchpadInterventionAllowed")),a=parseInt(localStorage.getItem("lastScratchpadInterventionTime"),10);
b=(typeof b===null)?true:(b=="true");a=(isNaN(a))?0:a;if(!b&&(new Date().getTime()-a)>(24*60*60*1000)){localStorage.setItem("scratchpadInterventionAllowed",true);localStorage.setItem("lastScratchpadInterventionTime",0);b=true;}return b;}return false;})();window.logScratchpadIntervention=function(a){a=a||{url:"/",type:"POST",data:{},timeout:1};window.scratchpadInterventionAllowed=false;if(window.localStorage){localStorage.setItem("scratchpadInterventionAllowed",false);localStorage.setItem("lastScratchpadInterventionTime",new Date().getTime());}};(function(){window.Scratchpad=window.Scratchpad||{};if(window.Scratchpad.page){var c=window.Scratchpad.page;}if(window.Scratchpad.headerTray){var b=window.Scratchpad.headerTray;}if(window.Scratchpad.TrayItem){var a=window.Scratchpad.TrayItem;}window.Scratchpad={page:c||{},headerTray:b||{},trayItem:a||{},init:function(){alert("yo!");},_request:function(g,d,e,f){return $.ajax({url:g,type:e||"GET",dataType:d||"json",data:f||{},cache:false,timeout:5000});}};})();(function(){window.Scratchpad=window.Scratchpad||{};window.Scratchpad.TrayItem=function(e){var d="";var b=Scratchpad.headerTray.locStrings;this.trayIndex=e.trayIndex||null;if(!e.product){return;}if(e.product=="HOTEL"&&e.type==="DETAIL"){this.type="hotel";this.attributes=e.hotel;if(!this.get("price")){this.set("price","");this.set("lastSeenDate",b.seePrice);}else{var h=b.asOf.replace("1/2/03",this.get("lastSeenDate")).replace("####",this.get("lastSeenDate"));this.set("lastSeenDate",h);}d=/\?/.test(this.get("deepLinkUrl"))?"&":"?";this.set("rfrrString",(d+"rfrr=SP.Tray."+this.trayIndex+"."+"HI"));this.set("deepLinkUrl",(this.get("deepLinkUrl")+this.get("rfrrString")));if(this.get("thumbnailUrl")){this.set("thumbnailUrl",(this.get("thumbnailUrl").replace("_s","_t")));}this.template=Scratchpad.headerTray.templates.hotelTemplate;this.$el=$($.trim(this.template(this.attributes)));if(!this.get("checkInDate")||!this.get("checkOutDate")){this.$el.addClass("dateless");}else{if(this.get("price")===""){this.$el.addClass("priceless");}}}else{if(e.product=="HOTEL"&&e.type==="SEARCH"){this.type="hotelSearch";this.attributes=e.hotelSearch;this.set("viewCount",0);d=/\?/.test(this.get("deepLinkUrl"))?"&":"?";this.set("rfrrString",(d+"rfrr=SP.Tray."+this.trayIndex+"."+"HS"));this.set("deepLinkUrl",(this.get("deepLinkUrl")+this.get("rfrrString")));if(this.get("thumbnailUrl")){this.set("thumbnailUrl",(this.get("thumbnailUrl").replace("_s","_t")));}this.template=Scratchpad.headerTray.templates.hotelSearchTemplate;this.$el=$($.trim(this.template(this.attributes)));}else{if(e.product=="AIR"){this.type="flight";this.attributes=e.flight;var c=Scratchpad.headerTray.locStrings.fromTo;c=c.replace("####",this.get("departureAirportCode"));c=c.replace("####",this.get("arrivalAirportCode"));this.set("airportToAirport",c);if(!this.get("price")){this.set("price","");this.set("lastSeen","See price");}else{var g=b.from.replace("15.00",this.get("price")).replace("####",this.get("price"));var f=b.asOf.replace("1/2/03",this.get("lastSeen")).replace("####",this.get("lastSeen"));this.set("price",g);this.set("lastSeen",f);}d=/\?/.test(this.attributes.deepLinkUrl)?"&":"?";if(this.get("returnDate")){this.set("returnDate",(" - "+this.get("returnDate")));}else{this.set("returnDate","");}this.set("rfrrString",(d+"rfrr=SP.Tray."+this.trayIndex+"."+"FS"));this.set("deepLinkUrl",(this.get("deepLinkUrl")+this.get("rfrrString")));if(this.get("routeType")){var a=this.get("routeType").replace("ROUND_TRIP",Scratchpad.headerTray.locStrings.roundTrip).replace("ONE_WAY",Scratchpad.headerTray.locStrings.oneWay);this.set("routeType",a);}this.template=Scratchpad.headerTray.templates.flightTemplate;this.$el=$($.trim(this.template(this.attributes)));if(!this.get("departureDate")){this.$el.addClass("dateless");}else{if(this.get("price")===""){this.$el.addClass("priceless");}}}else{if(e.product=="PACKAGE"){this.type="package";this.attributes=e.packages;if(!this.get("price")){this.set("price","");this.set("lastSeen","See price");}else{var g=b.from.replace("15.00",this.get("price")).replace("####",this.get("price"));var f=b.asOf.replace("1/2/03",this.get("lastSeen")).replace("####",this.get("lastSeen"));this.set("price",g);this.set("lastSeen",f);}if(this.get("returnDate")){this.set("returnDate",(" - "+this.get("returnDate")));}else{this.set("returnDate","");}d=/\?/.test(this.attributes.deepLinkUrl)?"&":"?";this.set("rfrrString",(d+"rfrr=SP.Tray."+this.trayIndex+"."+"PS"));this.set("deepLinkUrl",(this.get("deepLinkUrl")+this.get("rfrrString")));this.template=Scratchpad.headerTray.templates.packageTemplate;this.$el=$($.trim(this.template(this.attributes)));}}}}if(this.trayIndex===1){this.$el.addClass("first");}};window.Scratchpad.TrayItem.prototype={set:function(a,c,b){var d=false;if(this.attributes[a]&&this.attributes[a]===c){return;}else{this.attributes[a]=c;if(b){this.updateDisplay();}}},get:function(a){var b=null;if(this.attributes[a]){b=this.attributes[a];}return b;},insertBefore:function(a){this.$el.insertBefore(a);},removeFromTray:function(){this.$el.remove();},moveToIndex:function(a){this.trayIndex=a;},updateDisplay:function(){var a=$($.trim(this.template(this.attributes))).find(".item-link");this.$el.empty().html(a);}};})();var Scratchpad=Scratchpad||{};(function(b){var a=window.jQuery||null;b.headerTray={$elements:{$history:null,$badge:null,$greeting:null,$viewAllItem:null},templates:{hotelTemplate:null,hotelSearchTemplate:null,flightTemplate:null,packageTemplate:null},state:{requestLateHistory:false,legacyTemplates:false,loggedInUser:false,guestUser:false,greeting:false,blockSaveHeader:false,blockNotesHeader:false,apiAttemptsRemaining:0,currentCount:-1,historyData:[],isOkToShowTray:false,trayIsTurnedOn:false,addSearchAsItem:false,doublewideTray:false,userHasNews:false,autoPopOk:false},endpoints:{historyCount:"/api/userhistory/count",historyData:"/api/userhistory",viewership:"/Hotels/Offers?action=getHotelProductActivity&hotelIds=",hotelInfo:"/UserActivityDataAjax/getAdditionalHotelAvailInfo/?",regionViewership:"/api/urgency/regionActivity/",sendMeNotes:"/scratchpad/sendmenotes"},locStrings:{scratchpadName:"Scratchpad",seePrice:"See price",asOf:"as of ####",from:"from ####",oneWay:"One way",roundTrip:"Round trip",fromTo:"#### to ####",others:"#### others viewing now",other:"1 other viewing now",plus:"#### + ####",included:"#### and #### included",notesConfirmation:"We'll send Scratchpad updates to you by email. Watch your inbox!",defaultHeaderMessage:"Things you view while shopping are saved here. Pick up where you left off.",getUpdates:"Get Scratchpad updates by email.",thingsSavedHere:"Things you view while shopping are saved here.",viewScratchpad:"View Scratchpad",viewAllItems:"View all #### items",searchIsSaved:"This search has been saved in your Scratchpad.",sendNotesTo:"We'll send updates to ####. Watch your inbox!",pageGetUpdates:"Get updates about things in your Scratchpad.",notAvailable:"Not available",findOutWhy:"Find out why",room:"1 room left at this price",rooms:"#### rooms left at this price",packages:"#### Packages",flight:"Flight",hotel:"hotel",car:"car",othersSearching:"#### others searching now",hotels:"#### Hotels",fromToHyphen:"#### - ####",hotelSearchAvgPerNight:"avg per night"},trayItems:[],productNameMap:{"FLIGHT":"Flight","HOTEL":"hotel","CAR":"car"},init:function(e){this.setUpJquery(e);var c=this,g=a.Deferred(),f=window.scratchpad2ColTrayTestBucket,h=window.scratchpadTestAnimationBucket,d=window.scratchpadBadgeFlareTLFlag;this.state.inCSMVPTest=(f=="1"||f=="2"||f=="3");this.state.autoPopOk=(window.scratchpadInterventionAllowed&&this.state.inCSMVPTest&&!/https:/i.test(document.location.protocol));this.getPageId(g);g.done(function(m){if(m==="Emain"){if(typeof addScratchpadBadge==="function"){addScratchpadBadge(true);}return;}c.locStrings=window.scratchpadLocStrings||c.locStrings;c.productNameMap={"FLIGHT":c.locStrings.flight,"HOTEL":c.locStrings.hotel,"CAR":c.locStrings.car};if(d&&d==1){setTimeout(function(){c.badgeFlareTL("flare");
},750);}if(m==="Flight-Search"){c.state.requestLateHistory=true;uitk.subscribe("Flights.ModuleBuilder.Controller.renderComplete",function(){c.getMostRecent(1);});if(!c.state.autoPopOk){if(h=="1"){c.searchTooltipTL();}else{if(h=="2"){c.trayOpenTL();}else{if(h=="3"){}}}}}else{if(m==="Package-Search"){c.state.requestLateHistory=true;var o=0;var k=setInterval(function(){o+=500;if(rendered&&totalResultsCount>0){clearInterval(k);c.getMostRecent(1);}else{if(o>10000){clearInterval(k);}}},500);}else{if(m==="Hotel-Search"){c.state.autoPopOk=false;}else{var l=["Hotels-Infosite","Packages-Infosite"];for(var n=0;n<l.length;n++){if(l[n]===m){c.state.requestLateHistory=true;c.getMostRecent(1);}}}}}c.locStrings=window.scratchpadLocStrings||c.locStrings;c.signedInUserCheck();c.localStorageCheck();c.updateCountEndpoint();c.handlebarsCheck();c.captureElements();c.captureTemplates();c.countCheck();});},getPageId:function(e){if(/pub\/agent\.dll/i.test(window.location.href)){e.resolve("Emain");return;}var d=0;var c=setInterval(function(){var g=a("#pageId");if(g.attr("value")){clearInterval(c);var f=g.attr("value").split(".");if((f[1]==="Hotels"||f[1]==="Packages")&&f[2]){f=f[1]+"-"+f[2];}else{if(/Flight-Search/i.test(f[1])){f="Flight-Search";}else{f=f[1];}}e.resolve(f);}else{if(d>100){clearInterval(c);e.resolve("Page Id did not arrive in time");}}d+=5;},5);},setUpJquery:function(c){if(window.jQuery&&!a){a=window.jQuery;}else{if(c){a=c;}}},localStorageCheck:function(){var g=false,c=[],f,h,e,d;if(window.localStorage){f=(localStorage.getItem("scratchpadDeclineSaveInTray")=="true");h=(localStorage.getItem("scratchpadDeclineNotesInTray")=="true");if(h===null){g=true;c="Passed with missing flag(s): saveFlag is "+f+" and notesFlag is "+h;}else{this.state.blockSaveHeader=f;this.state.blockNotesHeader=h;c.push(f);c.push(h);g=true;}}else{c="No localStorage available";}return{pass:g,result:c};},signedInUserCheck:function(){var k=a("#guest-user-flag-for-scratchpad"),f=a("#registered-and-identified-user-flag-for-scratchpad"),d=a(".shop-nav").hasClass("signed-in"),c=[d],h=false,g,e;if(f&&f.attr("data-identifieduser")){e=(f.attr("data-identifieduser")=="true");c.push(e);}else{c="userStateFlag is missing or lacks required attributes";}if(k&&k.attr("data-guestuser")){g=(k.attr("data-guestuser")=="true");if(c.push){c.push(g);}}else{c="guestUserFlag is missing or lacks required attributes";}this.state.loggedInUser=(d||e);this.state.guestUser=g;h=(typeof c!="string");return{pass:h,result:c};},handlebarsCheck:function(){var c=(!!window.Handlebars&&!!window.uitk&&uitk.version.split(".")[0]==="v2");this.state.legacyTemplates=!c;return{pass:true,result:c};},updateCountEndpoint:function(){if(/https:/i.test(document.location.protocol)){return{pass:true,result:"don't update count endpoint on HTTPS pages"};}var g="tuid=",e=a("#scratchpad-badge-tuid").attr("data-id"),h=(a("#scratchpad-badge-site-id").attr("data-id")||1),d=a("#scratchpad-badge-url").attr("data-id"),k="",f=false,c=[];if(parseInt(e,10)===-1||e===""){e=a("#scratchpad-badge-guid").attr("data-id");g="guid=";c.push("GUID");}else{c.push("TUID");}if(!e||!d){c="Either userId or url is invalid";}else{d+="/userHistory/count/jsonp?";k=d+g+e+"&siteid="+h+"&format=jsonp&callback=?";this.endpoints.historyCount=k;if(c.push){c.push(k);}f=true;}return{pass:f,result:c};},captureElements:function(){var d=true,c="success";this.$elements.$history=a("#header-history.nav-tab");this.$elements.$badge=a("#scratchpad-badge");this.$elements.$greeting=a(".menu-header");this.$elements.$viewAllItem=a(".view-all-history");if(!this.$elements.$history||!this.$elements.$badge||!this.$elements.$greeting||!this.$elements.$viewAllItem){d=false;c="not all elements were captured";}return{pass:d,result:[c]};},localizer:function(f,c){var d=f;if(c){for(var e=0;e<c.length;e++){d=d.replace("####",c[e]);}}return d;},captureTemplates:function(){var d=this,e=true,c="success";if(!this.state.legacyTemplates){Handlebars.registerHelper("viewership",function(f){var g=parseInt(f,10);if(g>1){return d.locStrings.others.replace("3",f).replace("####",f);}else{if(g===1){return d.locStrings.other;}else{return"";}}});Handlebars.registerHelper("productDescription",function(f){var g=d.locStrings.included;if(f.length===2){g=g.replace("Something that could be in a package",d.productNameMap[f[0]]).replace("Something that could be in a package",d.productNameMap[f[1]]).replace("####",d.productNameMap[f[0]]).replace("####",d.productNameMap[f[1]]);}else{g="";}return g;});Handlebars.registerHelper("localizer",function(){var f="",g=[].splice.call(arguments,0,arguments.length-1),k=d.locStrings[g[0]],h=g.slice(1,g.length);if(k){f=d.localizer(k,h);}return f;});this.templates.hotelTemplate=Handlebars.compile(a("#hotel-tray-item-template").html());this.templates.hotelSearchTemplate=Handlebars.compile(a("#hotel-search-tray-item-template").html());this.templates.flightTemplate=Handlebars.compile(a("#flight-tray-item-template").html());this.templates.packageTemplate=Handlebars.compile(a("#package-tray-item-template").html());}else{this.templates.hotelTemplate=this.legacyHotelTemplate;this.templates.hotelSearchTemplate=this.legacyHotelSearchTemplate;this.templates.flightTemplate=this.legacyFlightTemplate;this.templates.packageTemplate=this.legacyPackageTemplate;}if(!this.templates.hotelTemplate||!this.templates.flightTemplate||!this.templates.hotelSearchTemplate||!this.templates.packageTemplate){e=false;c="not all templates assigned";}return{pass:e,result:[c]};},updateUI:function(){this.updateTrayHeader();this.updateBadge();this.updateTrayFooter();this.updateNavAction();},updateBadge:function(d){d=d||this.state.currentCount;var c=false;var e=window.scratchpadBadgeCountTLFlag;if(e==1){if(this.state.greeting){d++;}c=true;}else{if(e==2){c=true;}else{c=d>0;}}this.$elements.$badge.text(d).toggleClass("badge-urgent",c).toggleClass("visuallyhidden",!c);return{pass:true,result:[d,c,e]};},updateNavAction:function(){if(this.state.isOkToShowTray&&!this.state.trayIsTurnedOn){this.state.trayIsTurnedOn=true;a("<span>").addClass("icon icon-toggle180").appendTo(this.$elements.$history);this.$elements.$history.attr("data-control","menu").attr("href","#");}return{pass:true,result:[this.state.trayIsTurnedOn]};},declineSaveHeader:function(d,c){if(window.localStorage){localStorage.setItem("scratchpadDeclineSaveInTray",true);}if(!c&&window.dctk&&dctk.trackAction&&d){dctk.trackAction("Scratchpad.SaveLater",d);}this.state.blockSaveHeader=true;this.updateUI();return{pass:true,result:[!!window.localStorage,!!window.dctk]};},declineNotesHeader:function(d,c){if(window.localStorage){localStorage.setItem("scratchpadDeclineNotesInTray",true);}if(!c&&window.dctk&&dctk.trackAction&&d){dctk.trackAction("Scratchpad.NotesLater",d);}this.state.blockNotesHeader=true;this.updateUI();return{pass:true,result:[!!window.localStorage,!!window.dctk]};},acceptNotesHeader:function(c){if(!c){this._request(this.endpoints.sendMeNotes,"json","POST",{sendMeNotes:true});}if(/scratchpad/.test(window.location.pathname)){a("#send-me-notes-on").prop("checked",true);}if(window.localStorage){localStorage.setItem("scratchpadDeclineNotesInTray",true);}if(!c&&window.dctk&&window.dctk.omtr){dctk.omtr.eVar28="Scratchpad TrayOptIn";dctk.omtr.events="event80";dctk.omtr.linkTrackVars="eVar28,events";dctk.omtr.linkTrackEvents="event80,event81";dctk.omtr.tl(true,"o","RFRR Action Link");}a(".optional-notes-buttons").hide().removeClass("active");a(".scratchpad-greeting .greeting-message").text(this.locStrings.notesConfirmation);this.state.blockNotesHeader=true;return{pass:true,result:[this.state.greeting]};},addLateItem:function(c){if(this.state.currentCount>=5){var e=this.state.historyData[4];var f=e.product=="HOTEL";e.trayIndex=c||this.trayItems.length+1;var d=new Scratchpad.TrayItem(e);this.trayItems.push(d);d.insertBefore(a(".scratchpad-item").last());if(f){this.getAndUpdateHotelProductActivity(d.get("hotelId"));}}return{pass:true,result:[this.state.currentCount,e,d]};},updateTrayHeader:function(){var e=this;
var f=this.state.userHasNews;var c=!this.state.blockSaveHeader&&(!this.state.loggedInUser||this.state.guestUser);var d=(this.state.loggedInUser&&!this.state.blockNotesHeader&&(a(".optional-notes-buttons").length>0));if(f||c||d||this.state.currentCount===0){this.state.greeting=true;a(".optional-notes-buttons").hide().removeClass("active");a(".optional-save-buttons").hide().removeClass("active");a(".optional-news-buttons").hide().removeClass("active");}else{this.state.greeting=false;}if(f||c||d){if(c){this.showSaveHeader();}else{if(d){this.showNotesHeader();}else{if(f){}}}}else{this.showDefaultHeader();}if(this.state.greeting){if(this.state.currentCount!==0){a(".user-history-tab .menu").addClass("two-column");}this.$elements.$greeting.show();a(".scratchpad-item.first").removeClass("first");}else{a(".user-history-tab .menu").removeClass("two-column");this.$elements.$greeting.hide();a(".scratchpad-item").first().addClass("first");}return{pass:true,result:[c,d,this.state.currentCount,this.state.greeting]};},showSaveHeader:function(){var c=this,d=this.locStrings.defaultHeaderMessage;a(".optional-save-buttons").show().addClass("active");a(".scratchpad-greeting .greeting-message").text(d);a(".optional-save-buttons .btn-action").click(function(e){e.stopPropagation();window.location="/user/login?&ckoflag=0&amp;amp;hsuc=&amp;amp;fram=&uurl=qscr%3Dredr%26rurl%3D%2Fscratchpad";});a(".optional-save-buttons .sub-action").click(function(e){e.stopPropagation();c.declineSaveHeader(this);});return{pass:true,result:[d]};},showNotesHeader:function(){var c=this,g=window.scratchpad2ColTrayTestBucket,d="",e="",f="";if(g=="1"){d=this.locStrings.getUpdates;e="";f="";}else{if(g=="2"){d=this.locStrings.getUpdates;e="";f="";}else{if(g=="3"){d=this.locStrings.getUpdates;e="";f="";}else{d=this.locStrings.getUpdates;}}}a(".optional-notes-buttons").show().addClass("active");a(".scratchpad-greeting .greeting-message").text(d);if(this.state.autoPopOk){this.trayAutoPopTL();}a(".optional-notes-buttons .btn-action").click(function(h){h.stopPropagation();c.acceptNotesHeader();});a(".optional-notes-buttons .sub-action").click(function(h){h.stopPropagation();c.declineNotesHeader(this);});return{pass:true,result:[d]};},showNewsHeader:function(){var c=this,g=window.scratchpad2ColTrayTestBucket,d="",e="",f="";if(g=="1"){d=this.locStrings.getUpdates;e="";f="";}else{if(g=="2"){d=this.locStrings.getUpdates;e="";f="";}else{if(g=="3"){d=this.locStrings.getUpdates;e="";f="";}else{d=this.locStrings.getUpdates;}}}a(".optional-news-buttons").show().addClass("active");a(".scratchpad-greeting .greeting-message").text(d);a(".optional-notes-buttons .btn-action").click(function(h){h.stopPropagation();c.acceptNotesHeader();});},showDefaultHeader:function(){var c=this.locStrings.thingsSavedHere;a(".optional-save-buttons").hide();a(".optional-notes-buttons").hide();a(".scratchpad-greeting .greeting-message").text(c);return{pass:true,result:[c]};},updateTrayFooter:function(){var d=[this.locStrings.viewAllItems.replace("15",this.state.currentCount).replace("####",this.state.currentCount),this.locStrings.viewScratchpad],c=(4-this.state.currentCount);this.$elements.$viewAllItem.text(d[this.state.currentCount>5?0:1]);if(this.state.inCSMVPTest&&c>0&&this.state.currentCount!==0){this.$elements.$viewAllItem.parent().addClass("pad-"+c);}else{if(this.state.currentCount===0){this.$elements.$viewAllItem.parent().addClass("extra-padding");}}return{pass:true,result:[]};},legacyHotelTemplate:function(f){var c=Scratchpad.headerTray,e=parseInt(f.viewCount,10),g="";if(f.viewCount&&e===1){f.viewCount=c.locStrings.other;}else{if(f.viewCount&&e>1){f.viewCount=c.locStrings.others.replace("4",f.viewCount).replace("####",f.viewCount);}else{f.viewCount="";}}var d='<li class="scratchpad-item">'+'<a href="'+f.deepLinkUrl+'" class="item-link" data-onclick="">'+'<ul class="item-data">'+'<li class="item-title"><strong>'+f.hotelName+"</strong></li>"+'<li class="item-date">'+f.checkInDate+" - "+f.checkOutDate+"</li>"+'<li class="item-watches">'+f.viewCount+"</li>"+'<li class="item-price-urgency"><strong class="price">'+f.price+"</strong>"+f.lastSeenDate+"</li>"+'<li class="item-img-icon">'+'<img src="//media.expedia.com'+f.thumbnailUrl+'" alt="'+f.hotelName+'" class="image" aspectRatio="1-1">'+"</li>"+"</ul>"+"</a>"+"</li>";return d;},legacyHotelSearchTemplate:function(e){var c=Scratchpad.headerTray,g="",f="";if(e.viewCount){g=c.localizer(c.locStrings.othersSearching,[e.viewCount]);}if(e.amount){f='<li class="item-price-urgency"><strong class="price">'+e.price+"</strong>"+'<p class="item-package-message">'+c.localizer(c.locStrings.hotelSearchAvgPerNight)+"</p>"+c.localizer(c.locStrings.asOf,[e.lastSeenDate])+"</li>";}var d='<li class="scratchpad-item">'+'<a href="'+e.deepLinkUrl+'" class="item-link" data-onclick="">'+'<ul class="item-data">'+'<li class="item-title"><strong>'+c.localizer(c.locStrings.hotels,[e.destination])+"</strong></li>"+'<li class="item-date">'+c.localizer(c.locStrings.fromToHyphen,[e.checkInDate,e.checkOutDate])+"</li>"+'<li class="item-img-icon"><span class="icon icon-hotelsalt"></span></li>'+f+'<li class="item-watches">'+g+"&nbsp;</li>"+"</ul>"+"</a>"+"</li>";return d;},legacyFlightTemplate:function(d){var c='<li class="scratchpad-item">'+'<a href="'+d.deepLinkUrl+'" class="item-link" data-onclick="">'+'<ul class="item-data">'+'<li class="item-title"><strong>'+d.departureAirportCode+" to "+d.arrivalAirportCode+"</strong></li>"+'<li class="item-date">'+d.departureDate+d.returnDate+"</li>"+'<li class="item-info">'+d.routeType+"</li>"+'<li class="item-price-urgency"><strong class="price">'+d.price+"</strong>"+d.lastSeen+"</li>"+'<li class="item-img-icon">'+'<span class="icon icon-flightsalt"></span>'+"</li>"+"</ul>"+"</a>"+"</li>";return c;},legacyPackageTemplate:function(g){var d=Scratchpad.headerTray,c=d.locStrings.included,e=d.locStrings.packages.replace("####",g.packageDestination);if(g.products.length===2){c=c.replace("Something that could be in a package",d.productNameMap[g.products[0]]).replace("Something that could be in a package",d.productNameMap[g.products[1]]).replace("####",d.productNameMap[g.products[0]]).replace("####",d.productNameMap[g.products[1]]);}else{c="";}var f='<li class="scratchpad-item">'+'<a href="'+g.deepLinkUrl+'" class="item-link" data-onclick="">'+'<ul class="item-data">'+'<li class="item-title"><strong>'+e+"</strong></li>"+'<li class="item-date">'+g.departureDate+g.returnDate+"</li>"+'<li class="item-info">'+c+"</li>"+'<li class="item-price-urgency"><strong class="price">'+g.price+"</strong>"+'<p class="item-package-message"> per person</p>'+g.lastSeen+"</li>"+'<li class="item-img-icon">'+'<span class="icon icon-packagesalt"></span>'+"</li>"+"</ul>"+"</a>"+"</li>";return f;},searchTooltipTL:function(){if(!window.uitk){return;}setTimeout(function(){a(".user-history-tab").uitk_tooltip("show");a(".theme-urgency").animate({"opacity":"1"},200).delay(4500).animate({"opacity":"0"},200);},1500);return{pass:true,result:[]};},trayOpenTL:function(){var c=this;setTimeout(function(){a(".scratchpad-item").hide();a(".optional-save-buttons").hide();a(".optional-notes-buttons").hide();a(".scratchpad-greeting").show().find(".greeting-message").text(c.locStrings.searchIsSaved);c.$elements.$greeting.show();a(".scratchpad").addClass("fake-open-for-animation").find(".menu").css({"display":"none"}).slideDown().delay(1500).slideUp();setTimeout(function(){c.$elements.$greeting.hide();a(".scratchpad").removeClass("fake-open-for-animation").find(".menu").css({"display":"block"});a(".scratchpad-item").show();Scratchpad.headerTray.updateTrayHeader();},2300);},1500);return{pass:true,result:[]};},trayAutoPopTL:function(){if(a(window).width()<711){return;}var g=a(".item-list .scratchpad-item a").hide(),e=g.find(".image, .icon, .item-price-urgency").hide(),d=a(".menu-header .active").children().hide(),c=a(".greeting-message").hide(),f=g.add(d).add(c);setTimeout(function(){a(".user-history-tab").addClass("open");g.slideDown();
c.add(d).add(e).delay(250).fadeIn("fast");logScratchpadIntervention();},1000);this.state.autoPopOk=false;},badgeFlareTL:function(g,d){if(!this.state.currentCount>0||this.$elements.$badge.hasClass("visuallyhidden")){return;}var k=8,h=8,m=-4,l=-4;if(this.state.currentCount>9){k+=4;m=m+3;}g=g||"flare";if(g=="pulse"){var f=d||1;var c=500/f;for(var e=1;e<=f;e++){a(".scratchpad-flare").css({"opacity":"0.3","margin-left":k+"px","margin-top":"8px"}).animate({"width":"24px","height":"24px","margin-left":m+"px","margin-top":"-4px"},c/2).delay(1).animate({"width":"0","height":"0","margin-left":k+"px","margin-top":"8px"},c/2);}}else{if(g=="flare"){d=d||1000;a(".scratchpad-flare").css({"opacity":"1","margin-left":k+"px","margin-top":"8px"}).animate({"width":"30px","height":"30px","margin-left":(m-3)+"px","margin-top":"-7px","opacity":"0"},d).delay(1).animate({"width":"0","height":"0","margin-left":k+"px","margin-top":"8px"}).delay(1).animate({"opacity":"1"});}}return{pass:true,result:[]};},getMostRecent:function(d){var c=this;d=d||1;setTimeout(function(){c.updateUserHistoryData(d,true);},1000);},countCheck:function(){var d=this;var c=(this.endpoints.historyCount=="/api/userhistory/count")?"json":"jsonp";this._request(this.endpoints.historyCount,c).then(function(e){if(e.responsestatus&&e.responsestatus.status=="SUCCESS"){e.count=e.count||0;e.count=Math.min(e.count,30);d.state.currentCount=e.count;d.state.isOkToShowTray=true;if(e.count>0){d.updateUserHistoryData(Math.min(e.count,5),true);}else{d.updateUI();}}else{d.updateUserHistoryData(5,true);}}).fail(function(){d.updateUserHistoryData(0,true);});return{pass:true,result:[]};},updateUserHistoryData:function(c,f){var d=this;var e=this.endpoints.historyData;if(c>0){e+=("?limit="+c);}this._request(e).then(function(g){if(g&&g.status=="SUCCESS"&&g.userHistory){d.state.isOkToShowTray=true;d.handleUserHistoryCheck(g,f);}else{d.state.isOkToShowTray=false;}}).fail(function(){d.state.isOkToShowTray=false;});return{pass:true,result:[]};},handleUserHistoryCheck:function(h,n){var s=[],o,q,m;var l=(this.state.requestLateHistory&&this.state.historyData.length>0);var c=h.anyNews=="true";var p=(!this.state.loggedInUser&&!this.state.blockSaveHeader);var e=((a(".optional-notes-buttons").length>0)&&this.state.loggedInUser&&!this.state.blockNotesHeader);if(p||e&&!this.state.inCSMVPTest){o=Math.min(4,h.userHistory.length);}else{o=Math.min(5,h.userHistory.length);}if(l&&h.userHistory&&h.userHistory[0]){if(this.modelsMatch(h.userHistory[0],this.state.historyData[0])){return;}else{var r=this.removeMatchingTrayItem(h.userHistory[0]);if(!r){var f=true;for(var d=0;d<this.state.historyData.length;d++){if(this.modelsMatch(h.userHistory[0],this.state.historyData[d])){f=false;}}if(f){this.state.currentCount++;}}this.state.historyData.unshift(h.userHistory[0]);}m=new Scratchpad.TrayItem(h.userHistory[0]);this.trayItems.unshift(m);if(n&&this.trayItems.length>o){this.trayItems.pop().removeFromTray();}if(n){m.insertBefore(this.trayItems[1].$el);}s.push(m);}else{this.state.historyData=h.userHistory;this.state.currentCount=h.userHistory.length;for(var g=0;g<o;g++){q=h.userHistory[g];q.trayIndex=g+1;m=new Scratchpad.TrayItem(q);this.trayItems.push(m);s.push(m);if(n){m.insertBefore(a(".user-history-tab .menu li").last());}}}this.getAndUpdateHotelProductActivity();this.getRegionViews();if(n){this.updateUI();}return{pass:true,result:s};},getRegionViews:function(){var c=this,e,f;for(var d=0;d<this.trayItems.length;d++){e=this.trayItems[d];if(e.type!=="hotelSearch"){return;}f=this.endpoints.regionViewership+e.get("searchRegionId");this._request(f).then(function(g){if(g&&g.hotelProductActivityAtRegionLevelList){c.handleRegionViewershipResponse(g);}});}},handleRegionViewershipResponse:function(f){var e;for(var d=0;d<f.hotelProductActivityAtRegionLevelList.length;d++){e=f.hotelProductActivityAtRegionLevelList[d];for(var c=0;c<this.trayItems.length;c++){if(this.trayItems[c].get("searchRegionId")===e.regionId){this.trayItems[c].set("viewCount",e.viewCount,true);}else{continue;}}}},getAndUpdateHotelProductActivity:function(c){var e=this,d="",h="",g;if(c){d=c;}else{for(var f=0;f<this.trayItems.length;f++){g=this.trayItems[f];if(g.type==="hotel"){d+=g.get("hotelId")+",";}else{continue;}}}d=d.replace(/,$/,"");if(d!==""){h=this.endpoints.viewership+d+"&durationForViews=1800000&durationForBookings=172800000";this._request(h).then(function(k){if(k&&k.HotelProductActivityList){e.handleHotelViewershipResponse(k);}});}return{pass:true,result:h};},handleHotelViewershipResponse:function(f){var c=[],g;for(var e=0;e<f.HotelProductActivityList.length;e++){g=f.HotelProductActivityList[e];for(var d=0;d<this.trayItems.length;d++){if(parseInt(this.trayItems[d].get("hotelId"),10)===g.HotelId){g.ViewCount=this.numberWithCommas(g.ViewCount);if(this.trayItems[d].get("hotelId")==g.HotelId){this.trayItems[d].set("viewCount",g.ViewCount,true);c.push(g);}}else{continue;}}}return{pass:true,result:c};},numberWithCommas:function(c){var d=c.toString().split(".");d[0]=d[0].replace(/\B(?=(\d{3})+(?!\d))/g,",");return d.join(".");},removeMatchingTrayItem:function(c){var e=0,d={},f={"AIR":["flight","id"],"HOTEL":["hotel","hotelId"],"PACKAGE":["packages","id"]}[c.product];for(e;e<this.trayItems.length;e++){item=this.trayItems[e];if(item.type===f[0]&&(item.get(f[1])===c[f[0]][f[1]])){item.removeFromTray();return true;}}return false;},modelsMatch:function(e,d){if(e.hasOwnProperty("product")&&d.hasOwnProperty("product")&&(e.product===d.product)){var c={"AIR":["flight","id"],"HOTEL":["hotel","hotelId"],"PACKAGE":["packages","id"]}[e.product];if(e[c[0]][c[1]]===d[c[0]][c[1]]){return true;}else{return false;}}else{return false;}},_request:function(f,c,d,e){return a.ajax({url:f,type:d||"GET",dataType:c||"json",data:e||{},cache:false,timeout:5000});}};})(Scratchpad);
/*!  generated on 2014-06-05 15:08:30.441 PDT(-0700) in 31 ms  */

/*!  served in 0 ms  */
