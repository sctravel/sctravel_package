var Scratchpad=Scratchpad||{};(function(a){a.page={$elements:{$articleSections:$("div.search-section-container"),$messageCenter:$("#messageCenter")},endpoints:{hotelInfo:"/UserActivityDataAjax/getAdditionalHotelAvailInfo/?",clearAll:"/scratchpad/clearviewedhotels",clearSingle:"/scratchpad/clearactivity",sendMeNotes:"/scratchpad/sendmenotes"},sp_consts:{SCRATCHPAD_INFOAREA_CLOSED:"scratchpadInfoAreaClosed"},state:{freshPricingAllowed:true,newFlexcards:false},locStrings:{scratchpadName:"Scratchpad",seePrice:"See price",asOf:"as of ####",from:"from ####",oneWay:"One way",roundTrip:"Round trip",fromTo:"#### to ####",others:"#### others viewing now",other:"1 other viewing now",plus:"#### + ####",included:"#### and #### included",notesConfirmation:"We'll send Scratchpad updates to you by email. Watch your inbox!",defaultHeaderMessage:"Things you view while shopping are saved here. Pick up where you left off.",getUpdates:"Get Scratchpad updates by email.",thingsSavedHere:"Things you view while shopping are saved here.",viewScratchpad:"View Scratchpad",viewAllItems:"View all #### items",searchIsSaved:"This search has been saved in your Scratchpad.",sendNotesTo:"We'll send updates to ####. Watch your inbox!",pageGetUpdates:"Get updates about things in your Scratchpad.",notAvailable:"Not available",findOutWhy:"Find out why",room:"1 room left at this price",rooms:"#### rooms left at this price",packages:"#### Packages",flight:"Flight",hotel:"hotel",car:"car",othersSearching:"#### others searching now",hotels:"#### Hotels",fromToHyphen:"#### - ####"},responses:[],init:function(){var b=this;this.state.freshPricingAllowed=true;this.locStrings=window.scratchpadLocStrings||this.locStrings;this.state.newFlexcards=window.scratchpadNewFlexcardsEnabled;this.globalBind();this.setUpSendNotesToggle();$(":checkbox").attr("autocomplete","off");if(($(".info-area-container").length>0&&navigator.cookieEnabled&&this.getCookie(this.sp_consts.SCRATCHPAD_INFOAREA_CLOSED)!=="true")||window.location.search.indexOf("gpcid")==1){$(".info-area-container").slideDown("normal");}this.getPricing();var c=$("#send-me-notes-off:checked").length>0;if(c&&window.scratchpadNotesAddress){$(".on-off-switch").uitk_tooltip("show");}},globalBind:function(){var b=this,c=(this.state.newFlexcards)?".flex-card":"search-history-item";this.bindRemovalButtons();this.bindRetryButtons();$(".settings-area .link").click(function(d){$(c).toggleClass("activated");$(this).parent().toggleClass("activated");});$(".feedback .feedback-link").on("click",function(d){d.preventDefault();b.spHeaderFeedback(d);});},bindRemovalButtons:function(){var c=this,f=(Modernizr.touch)?["touchstart","click"]:["click"],b="";for(var d=0;d<f.length;d++){b=f[d];$("#removeAll").bind(b,function(g){g.preventDefault();c.removeAll();});$(".info-area-container .greeting-close").bind(b,function(h){h.preventDefault();h.stopPropagation();var g=$(this).closest(".info-area-container");g.slideUp("normal",function(){g.remove();});if(navigator.cookieEnabled){c.createCookie(c.sp_consts.SCRATCHPAD_INFOAREA_CLOSED,"true",30);}});var e=(this.state.newFlexcards)?".flex-close":".card-remove";$(e).bind(b,function(m){m.preventDefault();var n=$(this),j=n.data("target-id"),g=(c.state.newFlexcards)?".flex-card":".flexcard-listing",h=n.closest(g),l;groupClass=(c.state.newFlexcards)?".flex-list":".search-section-container",$group=h.closest(groupClass),$section=$group.closest(".search-section-container"),$clone=h.clone().data({index:h.index(),parent:h.parent()}),trackingString=n.attr("data-track"),ifHotels=h.is(".hotel"),last=false,delimiter="|||";if(!c.state.newFlexcards){j=n.find("button").data("target-id");h.parent().fadeOut();}if(ifHotels&&$group.find(g).length===1){var k=$section.data("search-id");if(k!==j){j+=(delimiter+k);}}if($group.find(g).length==1){$section.slideUp();last=true;}if(window.dctk){dctk.trackAction(trackingString,n[0]);}var i=c.removeSingle(j).done(function(o){if(o){if(last){$section.remove();}if($(".search-section-container").length===0){$(".message-container").removeClass("hidden");$(".content-footer").remove();}}else{}}).fail(function(p){var o=$clone.data("index")-1;if(o<=0){$($clone.data("parent")).children().eq(0).before($clone);}else{$($clone.data("parent")).children().eq(o).after($clone);}});});}},bindRetryButtons:function(){var b=this;$("#undoRemoveAll").add("#retry").click(function(d){d.preventDefault();var c=$("article.search-history-item").first().data("id");b.undoRemoveAll(c);b.$elements.$messageCenter.removeClass("clear-history error");});},setUpSendNotesToggle:function(){var b=this;$("#sendNotesToggle.testing").click(function(h){var c=$(this);var i=c.find(".slider-bar").toggleClass("off");var j=!i.hasClass("off");b.sendNotes(j);var g=(j)?"Updates On":"Updates Off";$("#ab4619tt").uitk_tooltip("updateContent",g);if(j){Scratchpad.headerTray.acceptNotesHeader(true);}else{Scratchpad.headerTray.declineNotesHeader(null,true);}var f=i.attr("authenticated")=="true";if(f&&window.dctk){var d=(j?"Scratchpad.OptIn":"Scratchpad.OptOut");dctk.omtr.eVar28=d;dctk.omtr.events=(j?"event80":"event81");dctk.omtr.linkTrackVars="eVar28,events";dctk.omtr.linkTrackEvents="event80,event81";dctk.omtr.tl(true,"o","RFRR Action Link");}setTimeout(function(){uitk.tooltips.hideAll();},2500);});uitk.subscribe("onOffSwitch.changed",function(c,g,i){var h=(i.value==="on");var e=(h?"Scratchpad.OptIn":"Scratchpad.OptOut");var f=(dctk.omtr.eVar28!=e);var d=$("fieldset.on-off-switch").attr("data-authenticated")=="true";b.sendNotes(g.context.defaultValue=="on",d);if(f&&d){dctk.omtr.eVar28=e;dctk.omtr.events=(h?"event80":"event81");dctk.omtr.linkTrackVars="eVar28,events";dctk.omtr.linkTrackEvents="event80,event81";dctk.omtr.tl(true,"o","RFRR Action Link");}if(h){Scratchpad.headerTray.acceptNotesHeader();}else{localStorage.setItem("scratchpadDeclineNotesInTray",false);}});},sendNotes:function(c){var b=this;return this._request({url:b.endpoints.sendMeNotes,type:"post",data:{sendMeNotes:c}}).done(function(d){if(!d){window.location.href="/user/login?ckoflag=0&hsuc=&fram=&uurl=qscr%3Dredr%26rurl%3D%2Fscratchpad%3FsendMeNotes%3Dtrue";}});},removeSingle:function(c){var b=this;return this._request({url:b.endpoints.clearSingle,type:"post",data:{uid:c}});},removeAll:function(){var b=this,c=$("article.search-history-item").first().data("id");$(".search-section-container").slideUp();b.$elements.$messageCenter.addClass("clear-history");return this._request({url:b.endpoints.clearAll,type:"post",data:{"uid":c,"hide":true},dataType:"text",success:function(d){if(d){}else{b.$elements.$messageCenter.addClass("clear-history error");$(".search-section-container").slideDown();}},error:function(d){b.$elements.$messageCenter.addClass("clear-history error");$(".search-section-container").slideDown();}});},undoRemoveAll:function(c){var b=this;return this._request({url:b.endpoints.clearAll,type:"post",data:{"uid":c,"hide":false},dataType:"text",success:function(d){if(d){$(".search-section-container").slideDown();}else{b.$elements.$messageCenter.addClass("undo-error");}},error:function(d){b.$elements.$messageCenter.addClass("undo-error");}}).always(function(d){});},createCookie:function(c,d,e){var b=new Date();b.setTime(b.getTime()+(e*24*60*60*1000));document.cookie=c+"="+d+"; expires="+b.toGMTString()+"; path=/";},getCookie:function(b){if(document.cookie.length>0){c_start=document.cookie.indexOf(b+"=");if(c_start!=-1){c_start=c_start+b.length+1;c_end=document.cookie.indexOf(";",c_start);if(c_end==-1){c_end=document.cookie.length;}return unescape(document.cookie.substring(c_start,c_end));}}return"";},spHeaderFeedback:function(f){var c=screen.width;var d=screen.height;var b=OpinionLab_FB.O_HT();var g=window.open("/p/info-other/feedback.htm?referer="+b+"&customvar="+OpinionLab_FB.O_CV()+"&prev="+OpinionLab_FB.O_PRV(),"ModalPopUp","toolbar=no,"+"scrollbars=no,"+"location=no,"+"statusbar=no,"+"menubar=no,"+"resizable=no,"+"width=635px,"+"height=280px,"+"screenX="+((c-535)/2)+","+"screenY="+((d-192)/2)+","+"left="+((c-535)/2)+","+"top="+((d-192)/2));
g.focus();},getPricing:function(){var d=this,e=this.getGroups(),c=(this.state.newFlexcards)?".flex-card":".flexcard-listing",b=(this.state.newFlexcards)?".flex-list":".history-items-container";setTimeout(function(){var f=$(".hotel .card-price-details").not(".priced");f.each(function(g,i){var h=$(i).closest(c);d.showOldHotelPrice(h);});$(".loader").animate({"opacity":"0"});},6000);if(!d.state.freshPricingAllowed){$(c+".hotel").each(function(f,g){d.showOldHotelPrice($(g));});}e.each(function(k,f){var o=$(f),h=o.next(b),g=o.attr("data-start-date"),l=o.attr("data-end-date"),m=o.attr("data-type"),j=o.attr("data-occupancy");if(m=="hotel"&&d.state.freshPricingAllowed){var n=d.getIdArrayFromGroup(h,"hotel");if(n.length){d.getPricesForGroup(m,g,l,n,j);}}h.find(c+":not(.hotel)").each(function(p,i){d.makeVisibleCardDetails(i);});});},getGroups:function(){return $(".section-header");},makeVisibleCardDetails:function(c){var b=(this.state.newFlexcards)?".flex-price":".card-price";$(c).find(".card-price-details .card-details, "+b).animate({"opacity":"1"});},getIdArrayFromGroup:function(d,e){var c=[],b=(this.state.newFlexcards)?".flex-card":".flexcard-listing";if(e){b+="."+e;}d.find(b).each(function(j,k){var h=$(k);var g=h.attr("id");var f=h.attr("data-currency");if(g&&f){c.push({hotelId:g,currencyCode:f,lastSeenPriceAmount:0});}});return c;},getPricesForGroup:function(f,b,g,e,c){if(!b||!g||b===""||g===""||!c||c===""){return;}var d=this,h={};roomArray=c.split("|"),mapPolyfill=function(m,l){var j=[];for(var k=0;k<m.length;k++){j[k]=l(m[k],k);}return j;};roomArray=mapPolyfill(roomArray,function(l,j){var i={};var k=l.split(":");if(k[3]){k[3]=k[3].split("#")||[];k[3]=mapPolyfill(k[3],function(m){return parseInt(m,10);});}else{k[3]=[];}i[k[0]]=parseInt(k[1],10);i[k[2]]=k[3];return i;});h={hotels:e,checkInDateString:b,checkOutDateString:g,roomOccupants:roomArray};this._request({url:"/api/userhistory/pricing",type:"POST",dataType:"json",contentType:"application/json",data:JSON.stringify(h),timeout:5000,success:function(k){if(k.status==="SUCCESS"&&k.priceUpdates&&k.priceUpdates.length>0){for(var j=0;j<k.priceUpdates.length;j++){d.updateHistoryItem(f,k.priceUpdates[j]);}}else{d.failGroupPriceCheck(e);return;}},error:function(i){d.failGroupPriceCheck(e);}});},updateHistoryItem:function(j,e){var k=(j=="hotel")?"hotelId":"flightId";var d=parseInt(e[k],10);var o=$("#"+d);var n=(e.hasOwnProperty("currentPrice")&&e.currentPrice!=null&&e.currentPrice.hasOwnProperty("amount"));if(!e.available){var i=(this.state.newFlexcards)?".flex-link":".card-link";var l=o.find(i).attr("href")||"#";var c='<div class="hotel-not-available-container text-hide">'+'<span class="not-available-text">'+this.locStrings.notAvailable+"</span>"+'<a class="find-out-link" href="'+l+'">'+this.locStrings.findOutWhy+"</a>"+"</div>";o.find(".card-price-details").addClass("priced").empty().html(c);}else{if(n){var h=e.currentPriceString;var f=(this.state.newFlexcards)?".flex-price":".card-price";var g=(this.state.newFlexcards)?".flex-supplemental":".supplemental-info";var b=(e.hasOwnProperty("numberOfRoomsLeft")&&e.numberOfRoomsLeft<6&&e.numberOfRoomsLeft>0);o.find(f+".new .amount").html(h);o.find(".card-price-details").addClass("priced new-price");o.find(".loader").fadeOut("fast");o.find(f+".old").hide();o.find(".card-price-details "+g).hide();o.find(f+".new").show();o.find(".card-price-details").fadeIn("slow");o.find(".card-price.new").animate({"opacity":1});if(b){if(e.numberOfRoomsLeft>1){var m=this.locStrings.rooms.replace("3",e.numberOfRoomsLeft).replace("####",e.numberOfRoomsLeft);}else{var m=this.locStrings.room;}o.find(".remaining").addClass("warning").find(".amount").text(m);o.find(".supplemental-info").animate({"opacity":1});}else{if(e.freeCancellation){o.find(".free").addClass("free-cancel");o.find(".supplemental-info").animate({"opacity":1});}}}else{this.showOldHotelPrice(o);}}},failGroupPriceCheck:function(d){for(var c=0;c<d.length;c++){var e=parseInt(d[c].hotelId,10);var b=$("#"+e);this.showOldHotelPrice(b);}},showOldHotelPrice:function(e){var d=(this.state.newFlexcards)?".flex-price":".card-price";var c=e.find(d+".old .amount").html()+"";if(c.length>1){c=parseInt(c.substring(1),10);}e.find(".loader").fadeOut("fast");if(c&&c>0){e.find(d+".new").hide();e.find(d+".old").show();e.find(".card-price-details").fadeIn("slow");e.find(".card-price.old").add(".card-price-details .card-details").animate({"opacity":1});}else{var g=(this.state.newFlexcards)?".flex-link":".card-link";var f=e.find(g).attr("href")||"#";var b='<div class="hotel-not-available-container text-hide">'+'<span class="not-available-text">'+this.locStrings.notAvailable+"</span>"+'<a class="find-out-link" href="'+f+'">'+this.locStrings.findOutWhy+"</a>"+"</div>";e.find(".card-price-details").addClass("priced").empty().html(b).fadeIn("slow");}e.find(".card-price-details").addClass("priced");},_request:function(b){return $.ajax(b);},_UXTEST:function(){var b='<div class="flexcard-listing multiflight"><a href="" class="card-link"><div class="flights-container"><ul class="flight-details-grid outbound-flight"><li class="airline-logo"><img src="http://media.expedia.com/media/content/expus/graphics/static_content/fusion/v0.1b/images/airlines/AS.gif" alt=""></li><li class="flight-number"><div class="operator">operator</div><div class="number">flightNumber</div></li><li class="flight-origin"><div class="time">9:40p</div><div class="airport-code">SEA</div></li><li class="flight-arrow"><div class="icon icon-arrow90"></div></li><li class="flight-destination"><div class="time">1:23a</div><div class="airport-code">ATL</div></li><li class="flight-duration"><div class="duration">#h ##m</div><div class="advisory">warning</div></li><li class="flight-stops"><div class="stop-type">stopType</div><div class="stop-codes">SEA, CHI, DFW</div></li></ul><ul class="flight-details-grid return-flight"><li class="airline-logo"><img src="http://media.expedia.com/media/content/expus/graphics/static_content/fusion/v0.1b/images/airlines/AS.gif" alt=""></li><li class="flight-number"><div class="operator">operator</div><div class="number">flightNumber</div></li><li class="flight-origin"><div class="time">5:32a</div><div class="airport-code">ATL</div></li><li class="flight-arrow"><div class="icon icon-arrow90"></div></li><li class="flight-destination"><div class="time">11:57a</div><div class="airport-code">SEA</div></li><li class="flight-duration"><div class="duration">#h ##m</div><div class="advisory">warning</div></li><li class="flight-stops"><div class="stop-type">stopType</div><div class="stop-codes">SEA, CHI, DFW</div></li></ul></div><div class="price-block"><div class="price"><div class="price-symbol">$</div><div class="price-amount">1234.56</div></div><div class="date">priceDate</div></div><div class="buffer-for-remove"></div></a><div class="card-remove" data-track=""><button class="remove-button" data-control="remove" data-target-id="FAKE" role="button"  data-track-events="none"><span class="icon icon-close" aria-hidden="true"></span><span class="alt">Remove</span></button></div></div>';$(".article-container").first().addClass("for-multiflight").find(".search-history-item").empty().first().html(b);}};})(Scratchpad);$(document).ready(function(){Scratchpad.page.init();var a=document.getElementById("toggleForGuidUser");if(a){document.getElementById("sendNotesToggle").reset();}});
/*!  generated on 2014-06-05 16:53:06.768 PDT(-0700) in 0 ms  */

/*!  served in 16 ms  */
